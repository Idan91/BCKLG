{"ast":null,"code":"require('./fetchLoader');\n\nconst Fetcher = require('./fetcher');\n\nconst users = require('./users');\n\nconst games = require('./games');\n\nconst {\n  pather\n} = require('./utils');\n\nmodule.exports = async ({\n  timeout = 60,\n  email,\n  password\n} = {}) => {\n  let cache = {};\n  let token = ''; // log in if creds were provided\n\n  if (email && password) {\n    const resp = await fetch(pather('auth')('login'), {\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n    const json = await resp.json();\n    token = json.key;\n  } // init fetcher\n\n\n  const fetcher = Fetcher(cache, timeout * 1000, token); // init cache purger\n\n  const purgeCache = cache => () => {\n    Object.entries(cache).forEach(i => clearTimeout(i[1].timeout));\n    Object.keys(cache).forEach(k => delete cache[k]);\n  }; // init lib\n\n\n  return {\n    fetcher,\n    users: users(fetcher),\n    games: games(fetcher),\n    purgeCache: purgeCache(cache)\n  };\n};","map":{"version":3,"sources":["/Users/Idan/Documents/GitHub/Idan91/BCKLG/bcklg/node_modules/rawger/src/rawger.js"],"names":["require","Fetcher","users","games","pather","module","exports","timeout","email","password","cache","token","resp","fetch","headers","Accept","method","body","JSON","stringify","json","key","fetcher","purgeCache","Object","entries","forEach","i","clearTimeout","keys","k"],"mappings":"AAAAA,OAAO,CAAC,eAAD,CAAP;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,WAAD,CAAvB;;AACA,MAAME,KAAK,GAAGF,OAAO,CAAC,SAAD,CAArB;;AACA,MAAMG,KAAK,GAAGH,OAAO,CAAC,SAAD,CAArB;;AACA,MAAM;AAAEI,EAAAA;AAAF,IAAaJ,OAAO,CAAC,SAAD,CAA1B;;AAEAK,MAAM,CAACC,OAAP,GAAiB,OAAO;AAAEC,EAAAA,OAAO,GAAG,EAAZ;AAAgBC,EAAAA,KAAhB;AAAuBC,EAAAA;AAAvB,IAAoC,EAA3C,KAAkD;AACjE,MAAIC,KAAK,GAAG,EAAZ;AACA,MAAIC,KAAK,GAAG,EAAZ,CAFiE,CAIjE;;AACA,MAAIH,KAAK,IAAIC,QAAb,EAAuB;AACrB,UAAMG,IAAI,GAAG,MAAMC,KAAK,CAACT,MAAM,CAAC,MAAD,CAAN,CAAe,OAAf,CAAD,EAA0B;AAChDU,MAAAA,OAAO,EAAE;AACP,wBAAgB,kBADT;AAEPC,QAAAA,MAAM,EAAE;AAFD,OADuC;AAKhDC,MAAAA,MAAM,EAAE,MALwC;AAMhDC,MAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAe;AACnBX,QAAAA,KADmB;AAEnBC,QAAAA;AAFmB,OAAf;AAN0C,KAA1B,CAAxB;AAYA,UAAMW,IAAI,GAAG,MAAMR,IAAI,CAACQ,IAAL,EAAnB;AACAT,IAAAA,KAAK,GAAGS,IAAI,CAACC,GAAb;AACD,GApBgE,CAsBjE;;;AACA,QAAMC,OAAO,GAAGrB,OAAO,CAACS,KAAD,EAAQH,OAAO,GAAG,IAAlB,EAAwBI,KAAxB,CAAvB,CAvBiE,CAyBjE;;AACA,QAAMY,UAAU,GAAGb,KAAK,IAAI,MAAM;AAChCc,IAAAA,MAAM,CAACC,OAAP,CAAef,KAAf,EAAsBgB,OAAtB,CAA8BC,CAAC,IAAIC,YAAY,CAACD,CAAC,CAAC,CAAD,CAAD,CAAKpB,OAAN,CAA/C;AACAiB,IAAAA,MAAM,CAACK,IAAP,CAAYnB,KAAZ,EAAmBgB,OAAnB,CAA2BI,CAAC,IAAI,OAAOpB,KAAK,CAACoB,CAAD,CAA5C;AACD,GAHD,CA1BiE,CA+BjE;;;AACA,SAAO;AACLR,IAAAA,OADK;AAELpB,IAAAA,KAAK,EAAEA,KAAK,CAACoB,OAAD,CAFP;AAGLnB,IAAAA,KAAK,EAAEA,KAAK,CAACmB,OAAD,CAHP;AAILC,IAAAA,UAAU,EAAEA,UAAU,CAACb,KAAD;AAJjB,GAAP;AAMD,CAtCD","sourcesContent":["require('./fetchLoader');\nconst Fetcher = require('./fetcher');\nconst users = require('./users');\nconst games = require('./games');\nconst { pather } = require('./utils');\n\nmodule.exports = async ({ timeout = 60, email, password } = {}) => {\n  let cache = {};\n  let token = '';\n\n  // log in if creds were provided\n  if (email && password) {\n    const resp = await fetch(pather('auth')('login'), {\n      headers: {\n        'Content-Type': 'application/json',\n        Accept: 'application/json'\n      },\n      method: 'POST',\n      body: JSON.stringify({\n        email,\n        password\n      })\n    });\n\n    const json = await resp.json();\n    token = json.key;\n  }\n\n  // init fetcher\n  const fetcher = Fetcher(cache, timeout * 1000, token);\n\n  // init cache purger\n  const purgeCache = cache => () => {\n    Object.entries(cache).forEach(i => clearTimeout(i[1].timeout));\n    Object.keys(cache).forEach(k => delete cache[k]);\n  };\n\n  // init lib\n  return {\n    fetcher,\n    users: users(fetcher),\n    games: games(fetcher),\n    purgeCache: purgeCache(cache)\n  };\n};\n"]},"metadata":{},"sourceType":"script"}